name: Commit Check
permissions:
  contents: read

on:
  pull_request:
    types: [opened, synchronize, reopened, edited]
  push:
    branches: [main, develop]

jobs:
  check-commits:
    name: Check Commits
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Validate commit messages
        run: |
          if [ "${{ github.event_name }}" == "pull_request" ]; then
            BASE_SHA="${{ github.event.pull_request.base.sha }}"
            HEAD_SHA="${{ github.event.pull_request.head.sha }}"
            
            echo "Checking commits in PR..."
            for commit in $(git rev-list $BASE_SHA..$HEAD_SHA); do
              COMMIT_MSG=$(git log -1 --format=%B $commit)
              FIRST_LINE=$(echo "$COMMIT_MSG" | head -1)
              
              # Check that commit message is not empty
              if [ -z "$FIRST_LINE" ]; then
                echo "❌ Commit $commit has empty commit message"
                exit 1
              fi
              
              # Check that commit message is not too short (less than 3 characters)
              if [ ${#FIRST_LINE} -lt 3 ]; then
                echo "⚠️  Warning: Commit $commit has very short commit message: '$FIRST_LINE'"
              fi
              
              echo "✅ Commit $commit: $FIRST_LINE"
            done
          else
            # For push events, check the latest commit
            COMMIT_MSG=$(git log -1 --format=%B HEAD)
            FIRST_LINE=$(echo "$COMMIT_MSG" | head -1)
            
            if [ -z "$FIRST_LINE" ]; then
              echo "❌ Latest commit has empty commit message"
              exit 1
            fi
            
            echo "✅ Latest commit: $FIRST_LINE"
          fi
